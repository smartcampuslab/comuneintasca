<?xml version="1.0" encoding="UTF-8"?>
<dataflow xmlns="http://smart.sayservice.it/schema/dataflow-schema"	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://smart.sayservice.it/schema/dataflow-schema http://smart.sayservice.it/schema/dataflow-schema-1.7.xsd">

    <input name="url" type="String" />
    
	<variable name="ristoranti" type="String"/>
	<variable name="ristorantien" type="String"/>
	<variable name="ristorantide" type="String"/>	
	<variable name="links" type="List"/>
	
	<httpConnector name="connector" method="GET" encoding="UTF-8"/>
	
	<connect name="c1" connector="connector" outputVar="ristoranti" transformer="string">
		<properties>
			<property name="url">
				<value>url</value>
			</property>
		</properties>
	</connect>		

	<script outputVar="links">
		<className>eu.trentorise.smartcampus.service.opendata.scripts.OpenContentScript</className>
		<method>extractLinks</method>
		<variables>
			<value>ristoranti</value>
		</variables>		
	</script>		
	
	<foreach item="link" itemClass="String" aggregateVariable="list" outputVar="output" writeAction="append" writeMethod="addAll">
		<items>links</items>
	    <connect name="c1" connector="connector" outputVar="ristoranti" transformer="string">
			<properties>
				<property name="url">
					<value>link</value>
				</property>
			</properties>
		</connect>		
	    <connect name="c2" connector="connector" outputVar="ristorantien" transformer="string">
			<properties>
				<property name="url">
					<value>link + "?Translation=eng-GB"</value>
				</property>
			</properties>
		</connect>		
	    <connect name="c3" connector="connector" outputVar="ristorantide" transformer="string">
			<properties>
				<property name="url">
					<value>link + "?Translation=ger-DE"</value>
				</property>
			</properties>
		</connect>			
		<script outputVar="list" writeAction="append" onError="abort">
			<className>eu.trentorise.smartcampus.service.opendata.scripts.RestaurantsScript</className>
			<method>extractData</method>
			<variables>
				<value>ristoranti</value>
				<value>ristorantien</value>
				<value>ristorantide</value>
			</variables>		
		</script>		
		    			    		    
	</foreach>
	
</dataflow>
